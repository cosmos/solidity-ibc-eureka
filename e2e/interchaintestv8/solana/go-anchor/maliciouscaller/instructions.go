// Code generated by https://github.com/gagliardetto/anchor-go. DO NOT EDIT.
// This file contains instructions.

package malicious_caller

import (
	"bytes"
	"fmt"
	errors "github.com/gagliardetto/anchor-go/errors"
	binary "github.com/gagliardetto/binary"
	solanago "github.com/gagliardetto/solana-go"
)

// Builds a "proxy_cpi" instruction.
// Execute an arbitrary CPI call from this program //  // This is a generic CPI proxy that forwards any instruction to any program. // The target program should validate the calling instruction's `program_id` // using the instructions sysvar to reject unauthorized callers. //  // # Arguments // * `target_program` - The program to CPI into // * `instruction_data` - The serialized instruction data to pass // * `account_metas` - Metadata for accounts (`is_signer`, `is_writable`) //  // # Security Note // This program intentionally does NOT validate anything - it's designed // to test that OTHER programs properly validate their CPI callers.
func NewProxyCpiInstruction(
	// Params:
	instructionDataParam []byte,
	accountMetasParam []MaliciousCallerCpiAccountMeta,

	// Accounts:
	targetProgramAccount solanago.PublicKey,
	payerAccount solanago.PublicKey,
) (solanago.Instruction, error) {
	buf__ := new(bytes.Buffer)
	enc__ := binary.NewBorshEncoder(buf__)

	// Encode the instruction discriminator.
	err := enc__.WriteBytes(Instruction_ProxyCpi[:], false)
	if err != nil {
		return nil, fmt.Errorf("failed to write instruction discriminator: %w", err)
	}
	{
		// Serialize `instructionDataParam`:
		err = enc__.Encode(instructionDataParam)
		if err != nil {
			return nil, errors.NewField("instructionDataParam", err)
		}
		// Serialize `accountMetasParam`:
		err = enc__.Encode(accountMetasParam)
		if err != nil {
			return nil, errors.NewField("accountMetasParam", err)
		}
	}
	accounts__ := solanago.AccountMetaSlice{}

	// Add the accounts to the instruction.
	{
		// Account 0 "target_program": Read-only, Non-signer, Required
		// unconstrained beyond executable check, as this is a test utility program
		// designed to proxy arbitrary CPI calls for security testing.
		accounts__.Append(solanago.NewAccountMeta(targetProgramAccount, false, false))
		// Account 1 "payer": Read-only, Signer, Required
		// Payer/signer for this transaction
		accounts__.Append(solanago.NewAccountMeta(payerAccount, false, true))
	}

	// Create the instruction.
	return solanago.NewInstruction(
		ProgramID,
		accounts__,
		buf__.Bytes(),
	), nil
}
